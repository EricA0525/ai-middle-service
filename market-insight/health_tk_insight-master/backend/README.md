# Market Insight Agent - Backend

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

åŸºäº LangGraph çš„å¸‚åœºæ´å¯ŸæŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆç³»ç»Ÿã€‚

### æ ¸å¿ƒåŠŸèƒ½
- **å“ç‰Œå¥åº·åº¦è¯Šæ–­**ï¼šåˆ†æå“ç‰Œå¸‚åœºå¥åº·çŠ¶å†µï¼Œç”Ÿæˆç»¼åˆè¯Šæ–­æŠ¥å‘Š
- **TikTok ç¤¾åª’æ´å¯Ÿ**ï¼šåˆ†æ TikTok çˆ†æ¬¾è§†é¢‘ï¼Œæ´å¯Ÿå¸‚åœºè¶‹åŠ¿

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app/                        # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                 # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py               # é…ç½®ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                    # API å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ deps.py             # API ä¾èµ–æ³¨å…¥
â”‚   â”‚   â””â”€â”€ v1/                 # API v1 ç‰ˆæœ¬
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ router.py       # è·¯ç”±æ±‡æ€»
â”‚   â”‚       â”œâ”€â”€ brand_health.py # å“ç‰Œå¥åº·åº¦æ¥å£
â”‚   â”‚       â”œâ”€â”€ tiktok_insight.py # TikTokæ´å¯Ÿæ¥å£
â”‚   â”‚       â””â”€â”€ tasks.py        # ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                 # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ request.py          # è¯·æ±‚æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ response.py         # å“åº”æ¨¡å‹
â”‚   â”‚   â””â”€â”€ task.py             # ä»»åŠ¡æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ services/               # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ task_manager.py     # ä»»åŠ¡ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ report_generator.py # æŠ¥å‘Šç”ŸæˆæœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/                 # LangGraph Agent
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py             # Agent åŸºç±»
â”‚   â”‚   â”œâ”€â”€ brand_health_agent.py   # å“ç‰Œå¥åº·åº¦ Agent
â”‚   â”‚   â”œâ”€â”€ tiktok_insight_agent.py # TikTokæ´å¯Ÿ Agent
â”‚   â”‚   â””â”€â”€ nodes/              # Agent èŠ‚ç‚¹
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ template_parser.py  # æ¨¡æ¿è§£æèŠ‚ç‚¹
â”‚   â”‚       â”œâ”€â”€ data_collector.py   # æ•°æ®é‡‡é›†èŠ‚ç‚¹
â”‚   â”‚       â”œâ”€â”€ content_generator.py # å†…å®¹ç”ŸæˆèŠ‚ç‚¹
â”‚   â”‚       â””â”€â”€ report_renderer.py  # æŠ¥å‘Šæ¸²æŸ“èŠ‚ç‚¹
â”‚   â”‚
â”‚   â”œâ”€â”€ data_sources/           # å¤–éƒ¨æ•°æ®æº
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py             # æ•°æ®æºåŸºç±»
â”‚   â”‚   â”œâ”€â”€ tavily_client.py    # Tavily æœç´¢å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ xiaohongshu.py      # å°çº¢ä¹¦ APIï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚   â”œâ”€â”€ douyin.py           # æŠ–éŸ³ APIï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚   â””â”€â”€ mock_data.py        # æ¨¡æ‹Ÿæ•°æ®ï¼ˆå¼€å‘ç”¨ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ templates/              # æŠ¥å‘Šæ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ brand_health.html   # å“ç‰Œå¥åº·åº¦æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ tiktok_insight.html # TikTokæ´å¯Ÿæ¨¡æ¿
â”‚   â”‚
â”‚   â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ svg_generator.py    # SVG å›¾è¡¨ç”Ÿæˆ
â”‚       â””â”€â”€ html_renderer.py    # HTML æ¸²æŸ“å·¥å…·
â”‚
â”œâ”€â”€ tests/                      # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_api.py
â”‚   â””â”€â”€ test_agents.py
â”‚
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ requirements.txt            # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ Dockerfile                  # Docker é…ç½®
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
cd backend
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥å¿…è¦çš„é…ç½®
```

### 3. å¯åŠ¨æœåŠ¡
```bash
# å¼€å‘æ¨¡å¼
uvicorn app.main:app --reload --port 8000

# å¯åŠ¨ Celery Workerï¼ˆå¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼‰
celery -A app.celery_app.celery_app worker --loglevel=info
```

### 4. è®¿é—® API æ–‡æ¡£
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## ğŸ”§ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### 1. å¼‚æ­¥ä»»åŠ¡æ¶æ„
```
ç”¨æˆ·è¯·æ±‚ â†’ FastAPI æ¥æ”¶ â†’ Celery ä»»åŠ¡å…¥é˜Ÿ â†’ è¿”å› task_id
                                    â†“
                            LangGraph Agent æ‰§è¡Œ
                                    â†“
                            ç”Ÿæˆ HTML æŠ¥å‘Š
                                    â†“
ç”¨æˆ·è½®è¯¢ task_id â† ä»»åŠ¡å®Œæˆï¼Œå­˜å‚¨ç»“æœ â† è¿”å› report_urlï¼ˆHTML æ–‡ä»¶æµï¼‰
```

### 2. LangGraph å·¥ä½œæµ
```
START â†’ æ¨¡æ¿è§£æ â†’ æ•°æ®é‡‡é›† â†’ å†…å®¹ç”Ÿæˆ â†’ æŠ¥å‘Šæ¸²æŸ“ â†’ END
              â†“         â†“         â†“
          Template   External    LLM
           Parser      APIs    Generator
```

### 3. æ•°æ®æºæŠ½è±¡
æ‰€æœ‰å¤–éƒ¨æ•°æ®æºç»§æ‰¿è‡ª `BaseDataSource`ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†å’Œæ‰©å±•ã€‚

## ğŸ“ å¼€å‘è§„èŒƒ

1. **API å‘½å**: ä½¿ç”¨ RESTful é£æ ¼
2. **å¼‚æ­¥å¤„ç†**: æ‰€æœ‰è€—æ—¶æ“ä½œå¿…é¡»å¼‚æ­¥æ‰§è¡Œ
3. **é”™è¯¯å¤„ç†**: ä½¿ç”¨ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
4. **æ—¥å¿—è®°å½•**: å…³é”®èŠ‚ç‚¹å¿…é¡»è®°å½•æ—¥å¿—
5. **ç±»å‹æ³¨è§£**: æ‰€æœ‰å‡½æ•°å¿…é¡»ä½¿ç”¨ Type Hints

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [äº§å“è®¾è®¡æ–‡æ¡£](../äº§å“è®¾è®¡.md)
- [API æ¥å£æ–‡æ¡£](./docs/api.md)
- [å¼€å‘æŒ‡å—](./docs/development.md)
