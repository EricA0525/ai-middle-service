# OpenAI API 配置（必填）
OPENAI_API_KEY=your_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1

# 模型配置
MODEL_NAME=gpt-4o

# Tavily 搜索（可选，用于联网实时信息）
TAVILY_API_KEY=
TAVILY_REQUEST_TIMEOUT_SECONDS=20
TAVILY_TOTAL_SEARCH_BUDGET_SECONDS=45
# Web Search 总超时（Tavily + LLM 解析阶段）
SEARCH_TOTAL_TIMEOUT_SECONDS=90

# 路径配置
TEMPLATE_DIR=./templates
OUTPUT_DIR=./output
MOCK_DATA_DIR=./mock_data

# 是否把 mock 数据注入到 LLM Prompt（默认关闭，避免品类污染）
INCLUDE_MOCK_PROMPT_DATA=false

# v2 作业系统配置
# 留空时默认写入 backend/output/.jobs/report_jobs.db
JOB_DB_PATH=
# 任务软超时（秒）
REPORT_JOB_SOFT_TIMEOUT_SECONDS=720
# 章节最小可见文本长度（质量闸门）
SECTION_MIN_TEXT_LEN=180
# 结构保真最低阈值（0~1）
STRUCTURE_FIDELITY_THRESHOLD=0.90

# 质量闸门未通过时是否仍发布报告（默认 true）
ALLOW_PUBLISH_ON_QUALITY_GATE_FAILURE=true

# LLM 生成总预算秒数（0=不限制）
LLM_TOTAL_BUDGET_SECONDS=0
# 单模块首轮生成超时（秒）
SECTION_LLM_TIMEOUT_SECONDS=120
# 单模块重试生成超时（秒）
SECTION_RETRY_TIMEOUT_SECONDS=75
# 搜索失败时是否降级继续正文生成
SEARCH_DEGRADE_ON_ERROR=true
# 重试阶段句内引用覆盖率阈值
RETRY_RELAX_INLINE_SOURCE_COVERAGE=0.70
# 重试阶段上下文压缩比（0~1）
RETRY_CONTEXT_COMPRESSION_RATIO=0.55
# 是否严格要求句内来源链接（仅在启用 web search 时生效）
INLINE_SOURCE_LINK_STRICT=true
# 是否自动补齐句内来源链接
INLINE_SOURCE_LINK_AUTO_INJECT=true

# ── P0 稳态配置 ──────────────────────────────────
# 任务并发 worker 数
MAX_CONCURRENT_JOBS=2
# 队列上限（等待中的任务数）
MAX_QUEUED_JOBS=10
# 停机优雅等待时长（秒）
SHUTDOWN_GRACE_PERIOD_SECONDS=30
# 提交幂等 TTL（秒）
IDEMPOTENCY_TTL_SECONDS=300

# API Key 认证（为空=关闭；生产环境建议开启）
API_SECRET_KEY=

# 速率限制（slowapi 格式）
RATE_LIMIT_GENERATE=1/3minutes
RATE_LIMIT_QUERY=60/minute
RATE_LIMIT_TEMPLATE=10/minute
